/* This code was generated by the Vult compiler v1-dev https://github.com/modlfo/vult */

#include "ad.h"

void Ad_do_type_init(Ad_do_type& _ctx) {
   Util_edge_type_init(_ctx.inst_10452);
   _ctx.out = 0.0f;
   _ctx.rate = 0.0f;
   _ctx.scale = 0.0f;
   _ctx.state = 0;
   _ctx.target = 0.0f;
}

float Ad_do(Ad_do_type& _ctx, float gate, float a, float d) {
   float a_rate = (1.0f / ((100.0f * a) + 0.01f));
   float d_rate = (1.0f / ((100.0f * d) + 0.01f));
   bool bgate = (gate > 0.0f);
   _ctx.out = (_ctx.out + (((_ctx.target - _ctx.out) * _ctx.rate) * 0.004f));
   if (_ctx.state == 0) {
      if (Util_edge(_ctx.inst_10452, bgate)) {
         _ctx.state = 1;
         _ctx.scale = (gate / 5.0f);
      }
      _ctx.rate = d_rate;
      _ctx.target = 0.0f;
   }
   if (_ctx.state == 1) {
      if (((bgate == false) || (_ctx.out > 1024.0f))) {
         _ctx.state = 0;
      }
      _ctx.rate = a_rate;
      _ctx.target = (1.2f * 1024.0f);
   }
   return (float_clip((_ctx.out / 1024.0f), 0.0f, 1.0f) * _ctx.scale);
}

