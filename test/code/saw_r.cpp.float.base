/* This code was generated by the Vult compiler v1-dev https://github.com/modlfo/vult */

#include "saw_r.h"

float Saw_r_process(Saw_r_process_type& _ctx, float cv) {
   if (Util_change(_ctx.inst_1b040, cv)) {
      _ctx.inc = Util_cvToRate(cv);
   }
   float i = 0.0f;
   if ((_ctx.inc < float_eps())) {
      i = float_eps();
   }
   else {
      i = _ctx.inc;
   }
   _ctx.phase = ((2.0f * _ctx.inc) + _ctx.phase);
   if ((_ctx.phase > 2.0f)) {
      _ctx.phase = (_ctx.phase - 2.0f);
   }
   else {
      _ctx.phase = _ctx.phase;
   }
   float ph = (_ctx.phase - 1.0f);
   float o = 0.0f;
   if ((ph >= (1.0f - i))) {
      float b = (((1.0f - i) - ph) / i);
      o = (ph + (b * abs(b)));
   }
   else {
      if ((ph <= (i - 1.0f))) {
         float b = (((i - 1.0f) - ph) / i);
         o = (ph + (b * abs(b)));
      }
      else {
         o = ph;
      }
   }
   return o;
}

