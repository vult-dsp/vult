/* This code was generated by the Vult compiler v1-dev https://github.com/modlfo/vult */

#include "sine.h"

fix16_t Phase_process(Phase_process_type& _ctx, fix16_t cv, fix16_t reset) {
   if (Util_change(_ctx.inst_1b08a, cv)) {
      _ctx.rate = Util_cvToRate_1024(cv);
   }
   if (Util_edge(_ctx.inst_2048a, (reset > 0x8000 /* 0.500000 */))) {
      _ctx.phase = 0x0 /* 0.000000 */;
   }
   else {
      _ctx.phase = (_ctx.phase + _ctx.rate);
   }
   if (_ctx.phase > 0x4000000 /* 1024.000000 */) {
      _ctx.phase = (-0x4000000 /* -1024.000000 */ + _ctx.phase);
   }
   else {
      _ctx.phase = _ctx.phase;
   }
   return fix_mul(0x40 /* 0.000977 */, _ctx.phase);
}

fix16_t Sine_process(Sine_process_type& _ctx, fix16_t cv, fix16_t reset) {
   if (Util_edge(_ctx.inst_104ba, (reset > 0x8000 /* 0.500000 */))) {
      _ctx.trig = true;
   }
   fix16_t phase = Phase_process(_ctx.p_8aba, cv, 0x0 /* 0.000000 */);
   if ((phase < fix_eps()) && _ctx.trig) {
      _ctx.trig = false;
      Phase_process(_ctx.p_8aba, cv, 0x0 /* 0.000000 */);
   }
   return Tables_nsine(phase);
}

