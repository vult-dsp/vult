
local this = {}
local ffi = require("ffi")
function this.ternary(cond,then_,else_) if cond then return then_ else return else_ end end
function this.eps()              return 1e-18; end
function this.pi()               return 3.1415926535897932384; end
function this.random()           return math.random(); end
function this.irandom()          return math.floor(math.random() * 4294967296); end
function this.clip(x,low,high)   return (this.ternary(x<low, low, this.ternary(x>high, high, x))); end
function this.real(x)            return x; end
function this.int(x)             local int_part,_ = math.modf(x) return int_part; end
function this.sin(x)             return math.sin(x); end
function this.cos(x)             return math.cos(x); end
function this.abs(x)             return math.abs(x); end
function this.exp(x)             return math.exp(x); end
function this.floor(x)           return math.floor(x); end
function this.tan(x)             return math.tan(x); end
function this.tanh(x)            return math.tanh(x); end
function this.sqrt(x)            return x; end
function this.set(a, i, v)       a[i+1]=v; end
function this.get(a, i)          return a[i+1]; end
function this.makeArray(size, v) local a = {}; for i=1,size do a[i]=v end return a; end
function this.wrap_array(a)      return a; end
local Saturate_soft_tanh_table_c0 = {(-4.1979167),(-4.080173),(-3.9627942),(-3.8458326),(-3.7293411),(-3.6133738),(-3.4979851),(-3.3832307),(-3.2691665),(-3.1558494),(-3.0433367),(-2.9316863),(-2.8209565),(-2.7112061),(-2.6024941),(-2.4948797),(-2.3884225),(-2.2831818),(-2.1792172),(-2.076588),(-1.9753533),(-1.875572),(-1.7773024),(-1.6806024),(-1.585529),(-1.4921389),(-1.4004874),(-1.3106291),(-1.2226172),(-1.136504),(-1.0523399),(-0.9701742),(-0.8900543),(-0.8120258),(-0.7361322),(-0.6624152),(-0.5909141),(-0.5216657),(-0.4547045),(-0.3900621),(-0.3277676),(-0.2678468),(-0.2103227),(-0.1552151),(-0.1025404),(-0.0523116),(-0.0045381),0.0407742,0.0836234,0.1240111,0.1619432,0.1974293,0.230483,0.2611223,0.2893692,0.3152498,0.3387943,0.3600374,0.3790175,0.3957776,0.4103645,0.422829,0.433226,0.4416141,0.4480557,0.4526167,0.4553666,0.4563781,0.4557268,0.4534916,0.4497538,0.4445971,0.4381076,0.4303731,0.4214831,0.4115287,0.4006016,0.3887945,0.3762006,0.3629128,0.349024,0.3346264,0.3198112,0.3046682,0.2892855,0.2737493,0.2581432,0.2425481,0.2270419,0.2116991,0.1965904,0.1817826,0.1673379,0.1533144,0.1397651,0.126738,0.114276,0.1024167,0.0911919,0.080628,0.0707457,0.0615599,0.0530798,0.0453088,0.0382445,0.0318792,0.0261994,0.0211865,0.0168166,0.0130609,0.009886,0.007254,0.005123,0.0034471,0.0021773,0.0012613,0.0006443,0.0002692,7.71e-05,7.8e-06,-0.,(-7.7e-06),(-7.7e-05),(-0.0002691),(-0.0006442),(-0.0012612),(-0.0021772),(-0.003447),(-0.0051229),(-0.0072539),(-0.0098859),(-0.0130608),(-0.0168165),(-0.0211864),(-0.0261993),(-0.0318791),(-0.0382444),(-0.0453087),(-0.0530797),(-0.0615598),(-0.0707456),(-0.0806279),(-0.0911918),(-0.1024166),(-0.1142759),(-0.1267379),(-0.139765),(-0.1533143),(-0.1673378),(-0.1817825),(-0.1965903),(-0.211699),(-0.2270418),(-0.242548),(-0.2581431),(-0.2737492),(-0.2892854),(-0.3046681),(-0.3198111),(-0.3346263),(-0.3490239),(-0.3629127),(-0.3762005),(-0.3887944),(-0.4006015),(-0.4115286),(-0.421483),(-0.430373),(-0.4381075),(-0.444597),(-0.4497537),(-0.4534915),(-0.4557267),(-0.456378),(-0.4553665),(-0.4526166),(-0.4480556),(-0.441614),(-0.4332259),(-0.4228289),(-0.4103644),(-0.3957775),(-0.3790174),(-0.3600373),(-0.3387942),(-0.3152497),(-0.2893691),(-0.2611222),(-0.2304829),(-0.1974292),(-0.1619431),(-0.124011),(-0.0836233),(-0.0407741),0.0045382,0.0523117,0.1025405,0.1552152,0.2103228,0.2678469,0.3277677,0.3900622,0.4547046,0.5216658,0.5909142,0.6624153,0.7361323,0.8120259,0.8900544,0.9701743,1.05234,1.1365041,1.2226173,1.3106292,1.4004875,1.492139,1.5855291,1.6806025,1.7773025,1.8755721,1.9753534,2.0765881,2.1792173,2.2831819,2.3884226,2.4948798,2.6024942,2.7112062,2.8209566,2.9316864,3.0433368,3.1558495,3.2691666,3.3832308,3.4979852,3.6133739,3.7293412,3.8458327,3.9627943,4.0801731,4.1979168,4.3159744}; 
local Saturate_soft_tanh_table_c1 = {0.6763382,0.6862324,0.6961791,0.7061748,0.7162158,0.7262982,0.7364178,0.7465706,0.7567519,0.7669573,0.7771819,0.7874208,0.7976689,0.8079209,0.8181712,0.8284141,0.8386439,0.8488545,0.8590397,0.8691931,0.8793082,0.8893783,0.8993965,0.9093558,0.9192491,0.9290689,0.9388079,0.9484585,0.9580129,0.9674634,0.976802,0.9860208,0.9951116,1.0040663,1.0128766,1.0215344,1.0300313,1.038359,1.0465092,1.0544738,1.0622444,1.0698129,1.0771713,1.0843115,1.0912256,1.097906,1.1043452,1.1105357,1.1164704,1.1221424,1.1275451,1.1326721,1.1375173,1.1420752,1.1463403,1.1503078,1.1539731,1.1573321,1.1603813,1.1631177,1.1655385,1.1676418,1.1694261,1.1708907,1.1720352,1.1728601,1.1733664,1.1735559,1.173431,1.1729947,1.1722511,1.1712046,1.1698606,1.168225,1.1663048,1.1641075,1.1616413,1.1589152,1.1559391,1.1527235,1.1492794,1.1456187,1.1417541,1.1376987,1.1334662,1.129071,1.1245282,1.1198531,1.1150616,1.11017,1.1051952,1.1001542,1.0950643,1.0899432,1.0848084,1.079678,1.0745699,1.0695018,1.0644918,1.0595575,1.0547164,1.0499857,1.0453824,1.0409229,1.0366233,1.0324992,1.0285655,1.0248365,1.0213257,1.018046,1.0150095,1.0122272,1.0097095,1.0074655,1.0055036,1.0038311,1.0024542,1.0013779,1.0006062,1.000142,0.9999871,1.000142,1.0006062,1.0013779,1.0024542,1.0038311,1.0055036,1.0074655,1.0097095,1.0122272,1.0150095,1.018046,1.0213257,1.0248365,1.0285655,1.0324992,1.0366233,1.0409229,1.0453824,1.0499857,1.0547164,1.0595575,1.0644918,1.0695018,1.0745699,1.079678,1.0848084,1.0899432,1.0950643,1.1001542,1.1051952,1.11017,1.1150616,1.1198531,1.1245282,1.129071,1.1334662,1.1376987,1.1417541,1.1456187,1.1492794,1.1527235,1.1559391,1.1589152,1.1616413,1.1641075,1.1663048,1.168225,1.1698606,1.1712046,1.1722511,1.1729947,1.173431,1.1735559,1.1733664,1.1728601,1.1720352,1.1708907,1.1694261,1.1676418,1.1655385,1.1631177,1.1603813,1.1573321,1.1539731,1.1503078,1.1463403,1.1420752,1.1375173,1.1326721,1.1275451,1.1221424,1.1164704,1.1105357,1.1043452,1.097906,1.0912256,1.0843115,1.0771713,1.0698129,1.0622444,1.0544738,1.0465092,1.038359,1.0300313,1.0215344,1.0128766,1.0040663,0.9951116,0.9860208,0.976802,0.9674634,0.9580129,0.9484585,0.9388079,0.9290689,0.9192491,0.9093558,0.8993965,0.8893783,0.8793082,0.8691931,0.8590397,0.8488545,0.8386439,0.8284141,0.8181712,0.8079209,0.7976689,0.7874208,0.7771819,0.7669573,0.7567519,0.7465706,0.7364178,0.7262982,0.7162158,0.7061748,0.6961791,0.6862324,0.6763382,0.6665}; 
local Saturate_soft_tanh_table_c2 = {0.0103258,0.0105337,0.0107444,0.010958,0.0111744,0.0113935,0.0116154,0.0118399,0.0120671,0.0122969,0.0125292,0.0127639,0.0130011,0.0132405,0.0134821,0.0137258,0.0139716,0.0142192,0.0144687,0.0147198,0.0149725,0.0152266,0.0154819,0.0157383,0.0159957,0.0162538,0.0165126,0.0167717,0.017031,0.0172903,0.0175493,0.0178079,0.0180658,0.0183227,0.0185784,0.0188326,0.019085,0.0193354,0.0195834,0.0198287,0.020071,0.02031,0.0205453,0.0207766,0.0210035,0.0212256,0.0214426,0.021654,0.0218595,0.0220587,0.0222511,0.0224362,0.0226138,0.0227833,0.0229443,0.0230964,0.023239,0.0233718,0.0234943,0.023606,0.0237064,0.0237951,0.0238717,0.0239356,0.0239864,0.0240237,0.024047,0.0240559,0.0240499,0.0240286,0.0239917,0.0239386,0.023869,0.0237825,0.0236788,0.0235576,0.0234184,0.0232611,0.0230852,0.0228907,0.0226772,0.0224445,0.0221925,0.0219209,0.0216298,0.021319,0.0209884,0.020638,0.0202678,0.019878,0.0194685,0.0190394,0.018591,0.0181235,0.017637,0.0171319,0.0166084,0.016067,0.015508,0.0149318,0.0143389,0.0137298,0.0131051,0.0124653,0.0118111,0.0111431,0.010462,0.0097685,0.0090633,0.0083473,0.0076213,0.006886,0.0061423,0.0053912,0.0046334,0.00387,0.0031017,0.0023297,0.0015547,0.0007779,-0.,(-0.0007778),(-0.0015546),(-0.0023296),(-0.0031016),(-0.0038699),(-0.0046333),(-0.0053911),(-0.0061422),(-0.0068859),(-0.0076212),(-0.0083472),(-0.0090632),(-0.0097684),(-0.0104619),(-0.011143),(-0.011811),(-0.0124652),(-0.013105),(-0.0137297),(-0.0143388),(-0.0149317),(-0.0155079),(-0.0160669),(-0.0166083),(-0.0171318),(-0.0176369),(-0.0181234),(-0.0185909),(-0.0190393),(-0.0194684),(-0.0198779),(-0.0202677),(-0.0206379),(-0.0209883),(-0.0213189),(-0.0216297),(-0.0219208),(-0.0221924),(-0.0224444),(-0.0226771),(-0.0228906),(-0.0230851),(-0.023261),(-0.0234183),(-0.0235575),(-0.0236787),(-0.0237824),(-0.0238689),(-0.0239385),(-0.0239916),(-0.0240285),(-0.0240498),(-0.0240558),(-0.0240469),(-0.0240236),(-0.0239863),(-0.0239355),(-0.0238716),(-0.023795),(-0.0237063),(-0.0236059),(-0.0234942),(-0.0233717),(-0.0232389),(-0.0230963),(-0.0229442),(-0.0227832),(-0.0226137),(-0.0224361),(-0.022251),(-0.0220586),(-0.0218594),(-0.0216539),(-0.0214425),(-0.0212255),(-0.0210034),(-0.0207765),(-0.0205452),(-0.0203099),(-0.0200709),(-0.0198286),(-0.0195833),(-0.0193353),(-0.0190849),(-0.0188325),(-0.0185783),(-0.0183226),(-0.0180657),(-0.0178078),(-0.0175492),(-0.0172902),(-0.0170309),(-0.0167716),(-0.0165125),(-0.0162537),(-0.0159956),(-0.0157382),(-0.0154818),(-0.0152265),(-0.0149724),(-0.0147197),(-0.0144686),(-0.0142191),(-0.0139715),(-0.0137257),(-0.013482),(-0.0132404),(-0.013001),(-0.0127638),(-0.0125291),(-0.0122968),(-0.012067),(-0.0118398),(-0.0116153),(-0.0113934),(-0.0111743),(-0.0109579),(-0.0107443),(-0.0105336),(-0.0103257),(-0.0101208)}; 
function this.Saturate_soft_tanh_table(x)
   local index = this.clip(this.int((5. * (x + 24.))),0,240); 
   return (Saturate_soft_tanh_table_c0[index+1] + (x * (Saturate_soft_tanh_table_c1[index+1] + (Saturate_soft_tanh_table_c2[index+1] * x)))); 

end

function this.Saturate_soft_process(_ctx,x)
   return this.Saturate_soft_tanh_table(x); 

end

function this.Saturate_soft_noteOn(_ctx,note,velocity,channel)

end

function this.Saturate_soft_noteOff(_ctx,note,channel)

end

function this.Saturate_soft_controlChange(_ctx,control,value,channel)

end

function this.Saturate_soft_default(_ctx)

end


function this.process(x) return this.Saturate_soft_process(x) end
function this.noteOn(note,velocity,channel) return this.Saturate_soft_noteOn(note,velocity,channel) end
function this.noteOff(note,channel) return this.Saturate_soft_noteOff(note,channel) end
function this.controlChange(control,value,channel) return this.Saturate_soft_controlChange(control,value,channel) end
function this.init() return this.Saturate_soft_process_init() end
function this.default(ctx) return this.Saturate_soft_default(ctx) end
this.config = { inputs = 1, outputs = 1, noteon_inputs = 3, noteoff_inputs = 2, controlchange_inputs = 3, is_active = false }
return this
