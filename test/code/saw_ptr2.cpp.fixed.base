/* This code was generated by the Vult compiler v1-dev https://github.com/vult-dsp/vult */

#include "saw_ptr2.h"

fix16_t Saw_ptr2_process(Saw_ptr2_process_type& _ctx, fix16_t cv) {
   if (Util_change(_ctx.inst_1b068, cv)) {
      _ctx.rate = Util_cvToRate(cv);
   }
   fix16_t s1 = _ctx.rate;
   fix16_t s2 = s1 + _ctx.rate;
   _ctx.phase = _ctx.phase + _ctx.rate;
   fix16_t out = 0x0 /* 0.000000 */;
   if (_ctx.phase > 0x10000 /* 1.000000 */) {
      _ctx.phase = -0x10000 /* -1.000000 */ + _ctx.phase;
   }
   else {
      _ctx.phase = _ctx.phase;
   }
   if (_ctx.phase < s1) {
      fix16_t d = fix_div(_ctx.phase, _ctx.rate);
      out = 0x10000 /* 1.000000 */ + fix_mul(d, (s2 + (- d)));
   }
   else {
      if (_ctx.phase < s2) {
         fix16_t d = fix_div(_ctx.phase, _ctx.rate);
         out = 0x30000 /* 3.000000 */ + fix_mul(d, (-0x40000 /* -4.000000 */ + d + s2));
      }
      else {
         out = -0x10000 /* -1.000000 */ + fix_mul(0x20000 /* 2.000000 */, _ctx.phase);
      }
   }
   return out;
}

