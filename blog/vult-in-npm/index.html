 <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://kit.fontawesome.com/aeb7435d58.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="../../css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="../../javascripts/bootstrap.min.js"></script>
<link rel="shortcut icon" href="../../images/favicon.ico" />

<nav class="navbar navbar-inverse">
   <div class="container-fluid top-menu">
      <a class="navbar-brand" href="../../"><img src="../../images/Vult-icon.png" alt="Vult" title="Vult" style="height:20px;"></a>

      
      <div class="navbar-header">
         <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
            aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      </div>

      
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

         <ul class="nav navbar-nav">
            <li><a href="https://vult-dsp.github.io/vult/"><i class='fa fa-home'></i> Home</a></li>
            <li><a href="https://vult-dsp.github.io/vult/overview/"><i class='fa fa-bullseye'></i> Overview</a></li>
            <li><a href="https://vult-dsp.github.io/vult/tutorials/"><i class='fa fa-book'></i> Docs</a></li>
            <li><a href="https://vult-dsp.github.io/vult/blog/"><i class='fa fa-newspaper-o'></i> Blog</a></li>
            <li><a href="https://vult-dsp.github.io/vult/demo/"><i class='fa fa-code'></i>Demo</a></li>
            <li><a href="https://github.com/vult-dsp/vult"><i class='fa fa-code-fork'></i>Source</a></li>
            <li><a href="https://www.npmjs.com/package/vult"><i class='fa fa-download'></i>Install</a></li>
            <li><a href="https://vult-dsp.com"><i class="fas fa-microchip"></i> Store</a></li>

         </ul>
      </div>
      
   </div>
   
</nav>

<div class="container">
   <div class="row">
      <div class="col-md-2"> </div>
      <div class="col-md-8 col-md-auto">
         <h2>Now Vult can be installed from npm</h2>
         <p>In the last months I have been making many improvements to the Vult compiler. These improvements cannot be easily tried by the users due to the fact that for me creating binaries for all the platforms is very time consuming. Therefore, in order for the users to try the latests changes they need to compile Vult from the source code. Even though the process is well documented in the repository, this can be time consuming and difficult for people unfamiliar with the OCaml tools.</p>
<p>I have been using <code>js_of_ocaml</code> for quite some time to convert parts of the Vult compiler to JavaScript that runs in the live demo page <a href="https://vult-dsp.github.io/vult/demo/">https://vult-dsp.github.io/vult/demo/</a> however the code there does not perform any I/O to disk since it&rsquo;s intended to run in the web browser.</p>
<p>I tried to convert the whole application to JavaScript to see if it could run (as it is) with the latest improvements of <code>js_of_ocaml</code>. That way I can distribute a JavaScript version that can be run with node.js. Node.js has many advantages, for example:</p>
<ul>
<li>runs in most platforms</li>
<li>easy to install</li>
<li>it has a good package manager</li>
</ul>
<p>Fortunately, the only thing that did not work was the file I/O (which seems reasonable). In order to make it work I made a small hack that allowed me to switch the functions that read and write files. That way I can declare bindings for the node.js functions and replace them. Here&rsquo;s the code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ocaml" data-lang="ocaml"><span style="color:#75715e">(** Declares a &#39;buffer&#39; object *)</span>
<span style="color:#66d9ef">class</span> <span style="color:#66d9ef">type</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">object</span>
   <span style="color:#66d9ef">method</span> toString <span style="color:#f92672">:</span> js_string t meth
<span style="color:#66d9ef">end</span>

<span style="color:#75715e">(** Declares a &#39;fs&#39; object *)</span>
<span style="color:#66d9ef">class</span> <span style="color:#66d9ef">type</span> fs <span style="color:#f92672">=</span> <span style="color:#66d9ef">object</span>
   <span style="color:#66d9ef">method</span> readFileSync <span style="color:#f92672">:</span> js_string t <span style="color:#f92672">-&gt;</span> buffer t meth
   <span style="color:#66d9ef">method</span> writeFileSync <span style="color:#f92672">:</span> js_string t <span style="color:#f92672">-&gt;</span> js_string t <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">unit</span> t meth
<span style="color:#66d9ef">end</span>

<span style="color:#75715e">(* var fs = require(&#39;fs&#39;) *)</span>
<span style="color:#66d9ef">let</span> fs <span style="color:#f92672">:</span> fs t <span style="color:#f92672">=</span>
   Unsafe.fun_call <span style="color:#f92672">(</span>Unsafe.js_expr <span style="color:#e6db74">&#34;require&#34;</span><span style="color:#f92672">)</span>
      <span style="color:#f92672">[|</span>Unsafe.inject <span style="color:#f92672">(</span><span style="color:#66d9ef">string</span> <span style="color:#e6db74">&#34;fs&#34;</span><span style="color:#f92672">)|]</span>

<span style="color:#66d9ef">let</span> read_fn <span style="color:#f92672">(</span>path<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> option <span style="color:#f92672">=</span>
   <span style="color:#66d9ef">let</span> buffer   <span style="color:#f92672">=</span> fs<span style="color:#f92672">##</span>readFileSync <span style="color:#f92672">(</span><span style="color:#66d9ef">string</span> path<span style="color:#f92672">)</span> <span style="color:#66d9ef">in</span>
   <span style="color:#66d9ef">let</span> contents <span style="color:#f92672">=</span> to_string <span style="color:#f92672">(</span>buffer<span style="color:#f92672">##</span>toString ()<span style="color:#f92672">)</span> <span style="color:#66d9ef">in</span>
   <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>contents<span style="color:#f92672">)</span>

<span style="color:#66d9ef">let</span> write_fn <span style="color:#f92672">(</span>path<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>text<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">bool</span> <span style="color:#f92672">=</span>
   <span style="color:#66d9ef">let</span> <span style="color:#f92672">_</span> <span style="color:#f92672">=</span> fs<span style="color:#f92672">##</span>writeFileSync <span style="color:#f92672">((</span><span style="color:#66d9ef">string</span> path<span style="color:#f92672">),(</span><span style="color:#66d9ef">string</span> text<span style="color:#f92672">))</span> <span style="color:#66d9ef">in</span>
   true
<span style="color:#f92672">;;</span>
</code></pre></div><p>Then I replace the functions as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ocaml" data-lang="ocaml">FileIO.setRead read_fn <span style="color:#f92672">;;</span>
FileIO.setWrite write_fn <span style="color:#f92672">;;</span>

</code></pre></div><p>With those changes it&rsquo;s possible to compile the bytecode and convert it to JavaScript. Now it&rsquo;s possible to run the Vult compiler as follows:</p>
<pre tabindex="0"><code>$ node vultjs.js arguments
</code></pre><p>Thanks to the npm it is even easier to install Vult an run it.</p>
<pre tabindex="0"><code>$ npm install vult -g
</code></pre><p>This command will give you an &ldquo;executable&rdquo; that can be called simply as <code>vultc</code>, for example:</p>
<pre tabindex="0"><code>$ vultc -ccode infile.vult -o outfile
</code></pre><p>This is the repository for the package <a href="https://github.com/modlfo/vultjs">https://github.com/modlfo/vultjs</a> and this is the main page of the npm package <a href="https://www.npmjs.com/package/vult">https://www.npmjs.com/package/vult</a></p>
<p>I will update the source code every time I think the changes in trunk are useful.</p> 

      </div>
   </div>
</div>


<link rel="stylesheet" type="text/css" href="../../css/vult.css">
<div class="container footer">Check our main <a href="https://vult-dsp.com/"> Vult-DSP </a> site</div>